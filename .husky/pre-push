#!/usr/bin/env sh

# Load nvm
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Run backend tests with coverage
echo "Running backend tests with coverage..."
npm run test:coverage || exit 1
npm run coverage:badge

# Run frontend tests with coverage
echo "Running frontend tests with coverage..."
cd frontend && npm run test:coverage -- --run && npm run coverage:badge || exit 1
cd ..

# Add coverage badges to the commit
git add coverage-backend.svg frontend/coverage-frontend.svg 2>/dev/null || true

echo "âœ“ All tests passed with coverage stats generated"
echo "  Backend coverage: coverage/lcov.info (badge: coverage-backend.svg)"
echo "  Frontend coverage: frontend/coverage/lcov.info (badge: frontend/coverage-frontend.svg)"
